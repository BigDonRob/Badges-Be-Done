<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badges-Be-Done</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Badges-Be-Done</h1>
        <p class="subtitle">Procedural badge compositing, batch-ready.</p>

        <!-- â”€â”€â”€ COLOR REFERENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-section ref-section">
            <h2>ðŸŽ¨ Color Reference Image</h2>
            <p class="section-desc">Optional source image used for color extraction across all generate layers.</p>
            <div class="ref-row">
                <div class="file-input-wrapper">
                    <input type="file" id="colorRefInput" accept="image/*">
                    <label for="colorRefInput" class="file-button">Choose Reference Image</label>
                </div>
                <span class="file-info" id="colorRefInfo">No file selected</span>
                <div class="ref-preview" id="colorRefPreview">
                    <img id="colorRefPreviewImg" alt="Color reference">
                </div>
            </div>
        </div>

        <!-- â”€â”€â”€ SESSION SAVE / LOAD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="session-bar">
            <span class="session-bar-label">WIP Session</span>
            <button class="session-btn session-btn--save" id="saveSessionBtn">ðŸ’¾ Save Session</button>
            <label class="session-btn session-btn--load" for="loadSessionInput">ðŸ“‚ Load Session</label>
            <input type="file" id="loadSessionInput" accept=".json" style="position:absolute;opacity:0;width:0;height:0;">
            <span class="session-status" id="sessionStatus"></span>
        </div>

        <!-- â”€â”€â”€ 1: BACKGROUND LAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-section">
            <h2>1. Background Layers</h2>
            <p class="section-desc">Compiled bottom-up. Not used for intersection detection.</p>
            <div id="bgLayerList" class="layer-list"></div>
            <button class="add-layer-btn" id="addBgLayerBtn">+ New Background Layer</button>
            <div style="margin-top:14px;">
                <button id="cycleBackgrounds" class="toggle-btn">Cycle Backgrounds</button>
                <p class="setting-hint">Regenerates all generate-type background layers with unique seeds per batch image.</p>
            </div>
            <div class="ls-preview-wrap">
                <span class="ls-preview-label">Compiled Background Preview</span>
                <canvas id="bgPreviewCanvas" class="ls-preview-canvas" width="256" height="256"></canvas>
            </div>
        </div>

        <!-- â”€â”€â”€ 2: MIDGROUND IMAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-section">
            <h2>2. Midground Images</h2>

            <details class="resources-tip" style="margin-bottom:20px;">
                <summary>ðŸ’¡ Tips for best results</summary>
                <div class="resources-body">
                    <p><strong>Image prep:</strong> Crop to 1:1 ratio. Use PNG with transparency for clean overlays.</p>
                    <p style="margin-top:8px;"><strong>Background removal:</strong> <a href="https://www.remove.bg/" target="_blank">remove.bg</a> works well for most images.</p>
                    <p style="margin-top:8px;"><strong>Top row â€” Slice Detection On:</strong> Opens the slice preview modal before processing. Choose which overlap regions get promoted above the border.</p>
                    <p style="margin-top:8px;"><strong>Bottom row â€” No Slice Detection:</strong> Composited directly, no modal.</p>
                </div>
            </details>

            <div class="dz-group dz-group-slice">
                <div class="dz-group-label">âœ‚ Slice Detection On</div>
                <div class="dz-row">
                    <div class="drop-zone" id="dzResizeSlice">
                        <div class="drop-zone-icon">â¤¢</div>
                        <div class="drop-zone-title">Resize &amp; Slice</div>
                        <p class="drop-zone-desc">Fills 64Ã—64 Â· slice on</p>
                        <label for="inputResizeSlice" class="file-button">Choose or drop Files</label>
                        <input type="file" id="inputResizeSlice" accept="image/*" multiple style="display:none;">
                        <div class="drop-zone-footer">
                            <span class="drop-zone-count" id="countResizeSlice">0 files</span>
                            <button class="clear-btn" id="clearResizeSlice">Clear</button>
                        </div>
                        <div class="file-list" id="fileListResizeSlice"></div>
                    </div>
                    <div class="drop-zone" id="dzCenterSlice">
                        <div class="drop-zone-icon">âŠ™</div>
                        <div class="drop-zone-title">Center &amp; Slice</div>
                        <p class="drop-zone-desc">Native size centered Â· slice on</p>
                        <label for="inputCenterSlice" class="file-button">Choose or drop Files</label>
                        <input type="file" id="inputCenterSlice" accept="image/*" multiple style="display:none;">
                        <div class="drop-zone-footer">
                            <span class="drop-zone-count" id="countCenterSlice">0 files</span>
                            <button class="clear-btn" id="clearCenterSlice">Clear</button>
                        </div>
                        <div class="file-list" id="fileListCenterSlice"></div>
                    </div>
                </div>
            </div>

            <div class="dz-group dz-group-noslice">
                <div class="dz-group-label">â–« No Slice Detection</div>
                <div class="dz-row">
                    <div class="drop-zone" id="dzResizeNoSlice">
                        <div class="drop-zone-icon">â¤¢</div>
                        <div class="drop-zone-title">Resize</div>
                        <p class="drop-zone-desc">Fills 64Ã—64 Â· no slicing</p>
                        <label for="inputResizeNoSlice" class="file-button">Choose or drop Files</label>
                        <input type="file" id="inputResizeNoSlice" accept="image/*" multiple style="display:none;">
                        <div class="drop-zone-footer">
                            <span class="drop-zone-count" id="countResizeNoSlice">0 files</span>
                            <button class="clear-btn" id="clearResizeNoSlice">Clear</button>
                        </div>
                        <div class="file-list" id="fileListResizeNoSlice"></div>
                    </div>
                    <div class="drop-zone" id="dzCenterNoSlice">
                        <div class="drop-zone-icon">âŠ™</div>
                        <div class="drop-zone-title">Center</div>
                        <p class="drop-zone-desc">Native size centered Â· no slicing</p>
                        <label for="inputCenterNoSlice" class="file-button">Choose or drop Files</label>
                        <input type="file" id="inputCenterNoSlice" accept="image/*" multiple style="display:none;">
                        <div class="drop-zone-footer">
                            <span class="drop-zone-count" id="countCenterNoSlice">0 files</span>
                            <button class="clear-btn" id="clearCenterNoSlice">Clear</button>
                        </div>
                        <div class="file-list" id="fileListCenterNoSlice"></div>
                    </div>
                </div>
            </div>

            <p class="total-files-info" id="totalFilesInfo" style="display:none;"></p>
        </div>

        <!-- â”€â”€â”€ 3: INTERACTION BORDERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-section">
            <h2>3. Interaction Borders / Icons</h2>
            <p class="section-desc">Compiled before slice detection. Overlapping midground pixels can be promoted to front layers.</p>
            
            <details class="resources-tip" style="margin-bottom:18px;">
                <summary>ðŸ“¦ Where to find pixel art borders</summary>
                <div class="resources-body">
                    <p>Accepts any 64Ã—64 RGBA PNG. Only non-transparent pixels show â€” the rest composites cleanly over the background and midground.</p>
                    <ul>
                        <li><a href="https://opengameart.org" target="_blank">OpenGameArt.org</a> â€” search "border" or "frame", filter by CC0</li>
                        <li><a href="https://kenney.nl/assets" target="_blank">Kenney.nl</a> â€” UI packs often include pixel borders</li>
                        <li><a href="https://itch.io/game-assets/free/tag-pixel-art" target="_blank">itch.io free pixel assets</a> â€” search "border frame"</li>
                        <li><a href="https://lospec.com" target="_blank">Lospec.com</a> â€” community pixel art tools and palettes</li>
                        <li><strong>Aseprite / Photoshop / GIMP</strong> â€” draw your own at 64Ã—64</li>
                    </ul>
                </div>
            </details>
            
            <div id="intersectionLayerList" class="layer-list"></div>
            <button class="add-layer-btn" id="addIntersectionLayerBtn">+ New Border / Icon Layer</button>
            <div class="ls-preview-wrap">
                <span class="ls-preview-label">Compiled Preview (Background + Interaction)</span>
                <canvas id="intersectionPreviewCanvas" class="ls-preview-canvas" width="256" height="256"></canvas>
            </div>
        </div>

        <!-- â”€â”€â”€ 4: OVERLAY LAYERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-section">
            <h2>4. Overlay Layers</h2>
            <p class="section-desc">Applied after all slicing. Always renders on top. Not used for overlap detection.</p>
            <div id="overlayLayerList" class="layer-list"></div>
            <button class="add-layer-btn" id="addOverlayLayerBtn">+ New Overlay Layer</button>
            <div class="ls-preview-wrap">
                <span class="ls-preview-label">Full Stack Preview (Background + Interaction + Overlay)</span>
                <canvas id="overlayPreviewCanvas" class="ls-preview-canvas" width="256" height="256"></canvas>
            </div>
        </div>

        <!-- â”€â”€â”€ PROCESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="upload-section">
            <h2>Process</h2>
            <button class="process-button" id="processButton" disabled>Process Images</button>
            <div class="status" id="status"></div>
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText"></div>
            </div>
        </div>

        <!-- â”€â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
        <div class="results" id="results">
            <h2>Processed Images</h2>
            <div class="image-grid" id="imageGrid"></div>
            <button class="download-all" id="downloadAll">Download All as ZIP</button>
            <button class="download-all" id="downloadSaveAs" style="margin-left:10px;">Save As ZIP</button>
            <button class="download-all" id="downloadIndividual" style="margin-left:10px;">Download All (Individual)</button>
        </div>
    </div>

    <!-- â”€â”€â”€ SLICE MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div id="sliceModal" class="slice-modal">
        <div class="slice-modal-content">
            <div class="slice-modal-header">
                <h3>Select Slice Variants</h3>
                <div class="slice-nav">
                    <button id="slicePrevBtn" class="slice-nav-btn" disabled>â—€</button>
                    <span id="sliceImageCounter">Image 1 / 1</span>
                    <button id="sliceNextBtn" class="slice-nav-btn">â–¶</button>
                </div>
            </div>
            <div class="slice-preview-area">
                <canvas id="slicePreviewCanvas" width="256" height="256"></canvas>
            </div>
            <div id="sliceCheckboxes" class="slice-checkboxes"></div>
            <div class="slice-modal-footer">
                <span class="slice-kbd-hint">Arrow keys: navigate &nbsp;Â·&nbsp; Enter: confirm ALL &nbsp;Â·&nbsp; Esc: cancel</span>
                <div class="slice-modal-buttons">
                    <button id="sliceConfirm" class="process-button" style="font-size:0.9em;padding:10px 28px;">âœ“ Confirm</button>
                    <button id="sliceCancel" class="download-all" style="margin-left:10px;">âœ• Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
